---
title: "Seeder Factory Validation"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [laravel]
published: false
---
### é•ã„
Seederã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’ï¼ˆä¸€æ‹¬ï¼‰æŒ¿å…¥ã™ã‚‹ä»•çµ„ã¿ã€‚
Factoryã¯Seederã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¸ãˆã‚‹ä»•çµ„ã¿ï¼ˆé€šå¸¸ã€Seederã®ä¸­ã§å‘¼ã³å‡ºã™ï¼‰ã€‚

FactoryãŒè¤‡æ•°ä»¶ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ç”¨ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚Œã°ã€Seederè‡ªä½“ã§ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã«å­˜åœ¨ã—ã¦ã»ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„æƒ…å ±ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã®ãŒå¦¥å½“ã§ã—ã‚‡ã†ã‹ã­ã€‚
### Seeder

### Factory
FakerãŒä½¿ã‚ã‚Œã‚‹
ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¦ãã‚Œã‚‹PHPãƒ©ã‚¤ãƒ–ãƒ©ãƒª
Fakerã¯ã€ãã®ã¾ã¾ã ã¨è‹±èªã£ã½ã„å˜èªãªã©ãŒã§ã¦ãã¡ã‚ƒã„ã¾ã™ãŒã€è¨­å®šã«ã‚ˆã‚Šæ—¥æœ¬èªå¯¾å¿œå¯èƒ½ã§ã™
config/app.phpã«è¿½è¨˜
'faker_locale' => env('APP_FAKER_LOCALE', 'ja_JP'),

ã¾ãšã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
composer require fzaninotto/faker
```
factoysä½œæˆã¯
```
docker-compose exec app php artisan make:factory --model=modelå
```

Laravel8ã«ãªã£ã¦ã‹ã‚‰ã€globalãªfactory()é–¢æ•°ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãã®ç‚ºã€ãƒ¢ãƒ‡ãƒ«ã®Factoryã‚¯ãƒ©ã‚¹ã‚’ä½¿ã„ã¾ã™ã€‚

1.è©²å½“ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ã€Illuminate\Database\Eloquent\Factories\HasFactoryãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã€‚

2.factoryå´ã«è©²å½“ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

factory(App\models\User::class)
User::factory

### error
SQLSTATE[23000]: Integrity constraint violation: 1062
 
 Integrity constraint violation => æ•´åˆæ€§è¦ç´„é•å
 
 åŸºæœ¬çš„ã«ã¯å®šç¾©ã«ã¯å½“ã¦ã¯ã‚ã‚‰ã‚Œãªã„æŒ™å‹•ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ãŸå ´åˆã«èµ·ã“ã‚‹ã‚¨ãƒ©ãƒ¼
 
Duplicate entry â€˜1â€™ for key â€˜PRIMARYâ€™

ã€ŒDuplicate entry â€˜1â€™ for key â€˜PRIMARYâ€™ã€ã‚¨ãƒ©ãƒ¼ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã«å…¥åŠ›ã—ã‚ˆã†ã¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¸»ã‚­ãƒ¼ï¼ˆidãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã©ï¼‰ãŒã™ã§ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼ˆé‡è¤‡ä¸å¯ã®ãŸã‚ï¼‰ã€‚

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```
php artisan make:request Xxx
```
app/Http/Requests/Xxx.php ã«ã¦ä½œæˆã€‚ã¾ãŸ
```php:Xxx
public function authorize()
{
    return false; // trueã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ä½¿ç”¨å¯èƒ½ã«
}
```
ãã®ä»–ã€attributes()
rules(),messages()ãªã©ã®ãƒ¡ã‚¾ãƒƒãƒˆå†…ã‚’ç·¨é›†

ä½¿ã„æ–¹ã¯ï¼Œä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãªã©ã§
```php:ExampleController
use App/Http/Requests/TestRequest;

class ExampleController extends Controller
{
    public function testMethod(Xxx $request) {
        // å‡¦ç† 
    }
}

https://qiita.com/OKCH3COOH/items/53db8780027e5e11be82